
                ifndef _CONFIG_TRDOS_INCLUDE_
                define _CONFIG_TRDOS_INCLUDE_

                module TRDOS
SECTOR_SIZE     EQU #0100                                                       ; размер сектора
SECTOR_NUM      EQU 0x10                                                        ; количество секторов в дорожке
TRACK_NUM       EQU 0xA0                                                        ; количество дорожек на диске
FILENAME_LENGTH EQU 0x08                                                        ; размер имени файла
FILE_LENGTH     EQU FILENAME_LENGTH + 1                                         ; размер имени файла + расширение
EXE_OUT_C:      EQU #2A53                                                       ; адрес OUT (C), A : RET
EXE_CMD:        EQU #3D13                                                       ; выполнить команду TR-DOS, содержащую в регистре C
EXE_RET:        EQU #3D2F                                                       ; выполнение подпрограмм TR-DOS, адресуемых через стек

NUM_DRIVE_A:    EQU #00
NUM_DRIVE_B:    EQU #01
NUM_DRIVE_C:    EQU #02
NUM_DRIVE_D:    EQU #03

; процедуры работы с TR-DOS используя вызов #3D13
RESTORE_VG93:   EQU #00                                                         ; выполняется команда "Восстановление" ВГ93: головка отводится на нулевую 
                                                                                ; дорожку и ожидает сигнала INTRQ. Ожидание можно прервать нажатием клавиши BREAK
INIT_DRIVE      EQU #01                                                         ; инициализация привода
                                                                                ; A - номер привода
RD_SECTORS      EQU #05                                                         ; чтение группы секторов. в регистре 
                                                                                ; B  - количество считываемых секторов,
                                                                                ; D  - номер начального трека,
                                                                                ; E  - начальный сектор, 
                                                                                ; HL - адрес буфера, в который производится чтение
WR_SECTORS      EQU #06                                                         ; запись группы секторов. в регистре 
                                                                                ; B  - количество записываемых секторов,
                                                                                ; D  - номер начального трека,
                                                                                ; E  - начальный сектор, 
                                                                                ; HL - адрес буфера, из которого производится запись
RD_FILE_INFO    EQU #08                                                         ; чтение информации о файле. в регистре A предварительно помещается порядковый номер файла (0-127).
                                                                                ; из каталога диска 16 байт переносятся в область системных переменных TR-DOS.
                                                                                ; не имеет значения, стерт ли этот файл или нет и существует ли он вообще.
FIND_FILE       EQU #0A                                                         ; поиск файла по имени, заданному в области системных переменных.
                                                                                ; номер найденного файла возвращается в регистр C, если не нашёл в регистре содержится #FF
                                                                                ; можно искать файлы по имени и типу (9 байт) или по любому  количеству первых байтов имени (от 1 до 16),
                                                                                ; следует лишь указать количество символов в системной переменной по адресу  #5D06.
LOAD_VERIFY     EQU #0E                                                         ; чтение / проверка  файла. имя и тип файла - в области системных переменных.
                                                                                ; при A = #00, адрес загрузки файла берется с директории 
                                                                                ; при A = #03, в HL адрес загрузки, в DE длина
                                                                                ; при A = #FF, в HL адрес загрузки, длина берётся из директории.
                                                                                ; байт поадресу #5CF9 определяет тип операции: #00 - LOAD, #FF - VERIFY.
SET_NAME        EQU #13                                                         ; в адрес #5CDD переписываются 16 байт информации из памяти, адресуемой регистровой парой HL
SET_SYS_REG     EQU #17                                                         ; устанавливает текущей сторону диска 1 (нижнюю), (значение из #5D16 маскируется AND #6F).
                                                                                ; Иначе говоря, загрузка системного регистра значением равным A AND #6F. 
SET_DISK_TYPE   EQU #18                                                         ; считывание системного сектора и настройка контроллера на тип дискеты


; переменные
WITH_RET:       EQU #5CC2                                                       ; содержит код команды RET. Используется TR-DOS для вызова подпрограмм Бесйик-ПЗУ.
DRIVE_A:        EQU #5CC8                                                       ; режима работы дисковода А
                                                                                ; 7 bit - 80/40 дорожечный, 
                                                                                ; 1 bit - двухсторонний/однасторонний дисковод
                                                                                ; 0 bit - двухсторонний/двухсторонний используется как односторонний
DRIVE_B:        EQU #5CC9                                                       ; режима работы дисковода B
                                                                                ; 7 bit - 80/40 дорожечный, 
                                                                                ; 1 bit - двухсторонний/однасторонний дисковод
                                                                                ; 0 bit - двухсторонний/двухсторонний используется как односторонний
DRIVE_C:        EQU #5CCA                                                       ; режима работы дисковода C
                                                                                ; 7 bit - 80/40 дорожечный, 
                                                                                ; 1 bit - двухсторонний/однасторонний дисковод
                                                                                ; 0 bit - двухсторонний/двухсторонний используется как односторонний
DRIVE_D:        EQU #5CCB                                                       ; режима работы дисковода D
                                                                                ; 7 bit - 80/40 дорожечный, 
                                                                                ; 1 bit - двухсторонний/однасторонний дисковод
                                                                                ; 0 bit - двухсторонний/двухсторонний используется как односторонний
HEAD:           EQU #5CDD                                                       ; имя файла                                                             [8 байт]
TYPE:           EQU #5CE5                                                       ; тип файла                                                             [1 байт]
START:          EQU #5CE6                                                       ; старт файла                                                           [2 байта]
SIZE_B:         EQU #5CE8                                                       ; размер файла в байтах                                                 [2 байта]
SIZE_S:         EQU #5CEA                                                       ; размер файла в секторах                                               [1 байт]
FIRST_S:        EQU #5CEB                                                       ; номер первого сектора файла                                           [1 байт]
FIRST_TR:       EQU #5CEC                                                       ; номер первого трека файла                                             [1 байт]
CUR_SEC:        EQU #5CF4                                                       ; следующий сектор + 1                                                  [1 байт]
CUR_TRK:        EQU #5CF5                                                       ; следующий трек + 1                                                    [1 байт]
TMP_DRIVE:      EQU #5CF6                                                       ; номер дисковод для временной операции                                 [1 байт]
DRIVE_SRC:      EQU #5CF8                                                       ; дисковод-источник при операции с двумя файлами (#00-#03) [#00]        [1 байт]
DRIVE_DIS:      EQU #5CF9                                                       ; дисковод-приемник при операции с двумя файлами (#00-#03) [#00]        [1 байт]
                                                                                ; тип операции: 
                                                                                ;   LOAD   - #00, 
                                                                                ;   VERIFY - #FF [#00] (при #FF вместо команд загрузки будет выполняться сравнение)
RATE_A:         EQU #5CFA                                                       ; время перемещения головки дисковода "A"                               [1 байт]
RATE_B:         EQU #5CFB                                                       ; время перемещения головки дисковода "B"                               [1 байт]
RATE_C:         EQU #5CFC                                                       ; время перемещения головки дисковода "C"                               [1 байт]
RATE_D:         EQU #5CFD                                                       ; время перемещения головки дисковода "D"                               [1 байт]
BUFFER:         EQU #5D00                                                       ; адрес буфера                                                          [2 байта]
SAVE_HL:        EQU #5D02
SAVE_DE:        EQU #5D04
NAME_LENGTH:    EQU #5D06                                                       ; длина по которому происходит поиск имени файла в каталоге (8-имя + 1-тип) [#09]
BUFF_FLAG:      EQU #5D0C                                                       ; признак выделения буфера ввода/вывода:                                [1 байт]
                                                                                ;   #00 - выделен, #FF - нет [#FF]
ERROR:          EQU #5D10                                                       ; старший байт ошибки при вызове TR-DOS или процедуры                   [1 байт]
MESS_FLAG:      EQU #5D15                                                       ; режим DOS: при #FF - выполнение команды DOS из BASICa, при #00 - работа в DOS
SYS_REG:        EQU #5D16                                                       ; копия системного регистра                                             [1 байт]
                                                                                ; режим работы контроллера, обычно номер дисковода + #3C/#2C
                                                                                ; см. далее описание порта #FF
DEFAULT_DRV:    EQU #5D19                                                       ; номер дисковода по умолчанию (0-3)   [#00]                            [1 байт]
                endmodule

                endif ; ~ _CONFIG_TRDOS_INCLUDE_